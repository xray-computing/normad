/*
 normad v1.3.2
 Normalisation d'Adresse Ã  partir des Open Data Gouvernementales

 ISC License
 by X-ray Computing
*/
document.addEventListener("DOMContentLoaded",function(){if("undefined"!==typeof normaFields){var x=Array.isArray(normaFields)?normaFields:Array(normaFields);for(field of x){let u=document.getElementById(field.address),n=document.getElementById(field.postcode),p=document.getElementById(field.city),q=field.partial;n.addEventListener("change",m=>{m=q?"q="+n.value+"&type=municipality":"q="+encodeURIComponent(u.value)+"&postcode="+n.value;var f=new XMLHttpRequest;f.onload=function(){const m=(a,b="change")=>
a&&a.dispatchEvent(new Event(b,{bubbles:!0}));if(200<=f.status&&300>f.status){var h=JSON.parse(f.response);if(!h.hasOwnProperty("features"))return console.log('Normad: Bad Response ("features" is missing)'),!1;for(var r=!1,g=document.querySelectorAll("script"),a=0;a<g.length;a++)if(0<g[a].src.indexOf("bootstrap")){var t=window.bootstrap?window.bootstrap.Tooltip.VERSION:$.fn.tooltip.Constructor.VERSION;r=!0;break}var e=[];g=[];for(a=0;a<h.features.length;a++){var b=h.features[a];0>g.indexOf(b.properties.id)&&
(e.push({id:b.properties.id,address:b.properties.name,postcode:b.properties.postcode,city:b.properties.city}),g.push(b.properties.id))}if(1<e.length){var k=document.getElementById("normadModal");if("undefined"==typeof k||null==k){a=document.createElement("div");a.className="modal";a.setAttribute("tabindex",-1);a.setAttribute("role","dialog");a.setAttribute("id","normadModal");h=document.createElement("div");h.className="modal-dialog";h.setAttribute("role","document");g=document.createElement("div");
g.className="modal-content";b=document.createElement("div");b.className="modal-header";var c=document.createElement("h5");c.className="modal-title";var d=document.createElement("button");d.className="close";d.setAttribute("type","button");d.setAttribute("data-dismiss","modal");d.setAttribute("aria-label","Fermer");var l=document.createElement("span");l.setAttribute("aria-hidden","true");l.innerHTML="&times;";d.appendChild(l);b.appendChild(c);b.appendChild(d);c=document.createElement("div");c.className=
"modal-body";let e=document.createElement("div");e.className="modal-footer";d=document.createElement("button");d.className="btn btn-primary";d.setAttribute("type","button");d.innerHTML="Valider mon choix";l=document.createElement("button");l.className="btn btn-secondary";l.setAttribute("type","button");l.innerHTML="Annuler";l.setAttribute("data-dismiss","modal");let f=[d,l];"undefined"!==typeof normaButtons&&(normaButtons.hasOwnProperty("cancel")&&(normaButtons.cancel.hasOwnProperty("label")&&(l.innerHTML=
normaButtons.cancel.label),normaButtons.cancel.hasOwnProperty("order")&&(f[parseInt(normaButtons.cancel.order)]=l)),normaButtons.hasOwnProperty("submit")&&(normaButtons.submit.hasOwnProperty("order")&&(d.order=normaButtons.submit.order),normaButtons.cancel.hasOwnProperty("order")&&(f[parseInt(normaButtons.submit.order)]=d)));f.forEach(a=>e.appendChild(a));g.appendChild(b);g.appendChild(c);g.appendChild(e);h.appendChild(g);a.appendChild(h);document.body.appendChild(a);k=document.getElementById("normadModal");
h=c}else h=k.querySelector(".modal-body");for(;h.firstChild&&h.removeChild(h.firstChild););k.querySelector(".modal-title").innerHTML="Choisissez une adresse valide";for(a=0;a<e.length;a++){g=e[a].postcode+" - "+e[a].city;q||(g=e[a].address+", "+g);b=document.createElement("div");b.className="input-group mb-1 m-b-1";c=document.createElement("input");c.setAttribute("type","radio");c.setAttribute("id","normAddr-"+a);c.setAttribute("name","normadChoice");c.dataset.id=a;if(r){if(0>t.indexOf("5.")){var v=
document.createElement("div");v.className="input-group-prepend input-group-addon"}d=document.createElement("div");d.className="input-group-text";d.appendChild(c);0>t.indexOf("5.")?(v.appendChild(d),b.appendChild(v)):b.appendChild(d)}else b.appendChild(c);c=document.createElement("label");c.className="form-control";c.setAttribute("for","normAddr-"+a);c.innerHTML=g;b.appendChild(c);h.appendChild(b)}if(r)if(0==t.indexOf("4.0"))jQuery("#normadModal").modal("show");else{var w=new window.bootstrap.Modal(k);
w.show()}else k.style.display="block",k.querySelector(".btn-secondary").addEventListener("click",a=>{k.style.display="none"}),k.querySelector(".close").addEventListener("click",a=>{k.style.display="none"});k.querySelector(".btn-primary").addEventListener("click",a=>{a=document.querySelectorAll('input[name="normadChoice"]:checked');1==a.length&&(q||(u.value=e[a[0].dataset.id].address),n.value=e[a[0].dataset.id].postcode,p.value=e[a[0].dataset.id].city,m(p));r?0==t.indexOf("4.0")?jQuery("#normadModal").modal("hide"):
w.hide():k.style.display="none"})}else 1==e.length?(q||(u.value=e[0].address),n.value=e[0].postcode,p.value=e[0].city,m(p)):console.log("Normad: No Address Found")}else console.log("Normad: Request Failed")};f.onerror=function(){console.log("Normad: Query Failed")};if("withCredentials"in f)f.open("GET","https://api-adresse.data.gouv.fr/search/?"+m,!0);else if("undefined"!=typeof XDomainRequest)f.open("GET","https://api-adresse.data.gouv.fr/search/?"+m);else throw f=null,Error("CORS not supported");
null!==f&&f.send()})}}else console.log("'normaFields' var. not defined.")});