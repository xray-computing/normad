/*
 normad v1.2.0
 Normalisation d'Adresse Ã  partir des Open Data Gouvernementales

 ISC License
 by X-ray Computing
*/
document.addEventListener("DOMContentLoaded",function(){if("undefined"!==typeof normaFields){var w=Array.isArray(normaFields)?normaFields:Array(normaFields);for(field of w){let t=document.getElementById(field.address),n=document.getElementById(field.postcode),p=document.getElementById(field.city),q=field.partial;n.addEventListener("change",m=>{m=q?"q="+n.value+"&type=municipality":"q="+encodeURIComponent(t.value)+"&postcode="+n.value;var k=new XMLHttpRequest;k.onload=function(){if(200<=k.status&&
300>k.status){var g=JSON.parse(k.response);if(!g.hasOwnProperty("features"))return console.log('Normad: Bad Response ("features" is missing)'),!1;for(var r=!1,f=document.querySelectorAll("script"),a=0;a<f.length;a++)if(0<f[a].src.indexOf("bootstrap")){var m=bootstrap.Tooltip.VERSION;r=!0;break}var b=[];f=[];for(a=0;a<g.features.length;a++){var c=g.features[a];0>f.indexOf(c.properties.id)&&(b.push({id:c.properties.id,address:c.properties.name,postcode:c.properties.postcode,city:c.properties.city}),
f.push(c.properties.id))}if(1<b.length){var h=document.getElementById("normadModal");if("undefined"==typeof h||null==h){a=document.createElement("div");a.className="modal";a.setAttribute("tabindex",-1);a.setAttribute("role","dialog");a.setAttribute("id","normadModal");g=document.createElement("div");g.className="modal-dialog";g.setAttribute("role","document");f=document.createElement("div");f.className="modal-content";c=document.createElement("div");c.className="modal-header";var d=document.createElement("h5");
d.className="modal-title";var e=document.createElement("button");e.className="close";e.setAttribute("type","button");e.setAttribute("data-dismiss","modal");e.setAttribute("aria-label","Fermer");var l=document.createElement("span");l.setAttribute("aria-hidden","true");l.innerHTML="&times;";e.appendChild(l);c.appendChild(d);c.appendChild(e);d=document.createElement("div");d.className="modal-body";e=document.createElement("div");e.className="modal-footer";l=document.createElement("button");l.className=
"btn btn-primary";l.setAttribute("type","button");l.innerHTML="Valider mon choix";let b=document.createElement("button");b.className="btn btn-secondary";b.setAttribute("type","button");b.innerHTML="Annuler";b.setAttribute("data-dismiss","modal");e.appendChild(l);e.appendChild(b);f.appendChild(c);f.appendChild(d);f.appendChild(e);g.appendChild(f);a.appendChild(g);document.body.appendChild(a);h=document.getElementById("normadModal");g=d}else g=h.querySelector(".modal-body");for(;g.firstChild&&g.removeChild(g.firstChild););
h.querySelector(".modal-title").innerHTML="Choisissez une adresse valide";for(a=0;a<b.length;a++){f=b[a].postcode+" - "+b[a].city;q||(f=b[a].address+", "+f);c=document.createElement("div");c.className="input-group mb-1";d=document.createElement("input");d.setAttribute("type","radio");d.setAttribute("id","normAddr-"+a);d.setAttribute("name","normadChoice");d.dataset.id=a;if(r){if(0>m.indexOf("5.")){var u=document.createElement("div");u.className="input-group-prepend"}e=document.createElement("div");
e.className="input-group-text";e.appendChild(d);0>m.indexOf("5.")?(u.appendChild(e),c.appendChild(u)):c.appendChild(e)}else c.appendChild(d);d=document.createElement("label");d.className="form-control";d.setAttribute("for","normAddr-"+a);d.innerHTML=f;c.appendChild(d);g.appendChild(c)}if(r){var v=new bootstrap.Modal(h);v.show()}else h.style.display="block",h.querySelector(".btn-secondary").addEventListener("click",a=>{h.style.display="none"}),h.querySelector(".close").addEventListener("click",a=>
{h.style.display="none"});h.querySelector(".btn-primary").addEventListener("click",a=>{a=document.querySelectorAll('input[name="normadChoice"]:checked');1==a.length&&(q||(t.value=b[a[0].dataset.id].address),n.value=b[a[0].dataset.id].postcode,p.value=b[a[0].dataset.id].city,p.dispatchEvent(new Event("change")));r?v.hide():h.style.display="none"})}else 1==b.length?(q||(t.value=b[0].address),n.value=b[0].postcode,p.value=b[0].city,p.dispatchEvent(new Event("change"))):console.log("Normad: No Address Found")}else console.log("Normad: Request Failed")};
k.onerror=function(){console.log("Normad: Query Failed")};if("withCredentials"in k)k.open("GET","https://api-adresse.data.gouv.fr/search/?"+m,!0);else if("undefined"!=typeof XDomainRequest)k.open("GET","https://api-adresse.data.gouv.fr/search/?"+m);else throw k=null,Error("CORS not supported");null!==k&&k.send()})}}else console.log("'normaFields' var. not defined.")});