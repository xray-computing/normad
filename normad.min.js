/*
 normad v1.0.0
 Normalisation d'Adresse Ã  partir des Open Data Gouvernementales

 ISC License
 by X-ray Computing
*/
document.addEventListener("DOMContentLoaded",function(){if("undefined"!==typeof normaFields){var u=Array.isArray(normaFields)?normaFields:Array(normaFields);for(field of u){let q=document.getElementById(field.address),m=document.getElementById(field.postcode),t=document.getElementById(field.city),n=field.partial;m.addEventListener("change",r=>{r=n?"q="+m.value+"&type=municipality":"q="+encodeURIComponent(q.value)+"&postcode="+m.value;var h=new XMLHttpRequest;h.onload=function(){if(200<=h.status&&
300>h.status){var l=JSON.parse(h.response);if(!l.hasOwnProperty("features"))return console.log('Normad: Bad Response ("features" is missing)'),!1;for(var p="function"===typeof popover,b=[],d=[],c=0;c<l.features.length;c++){var e=l.features[c];0>d.indexOf(e.properties.id)&&(b.push({id:e.properties.id,address:e.properties.name,postcode:e.properties.postcode,city:e.properties.city}),d.push(e.properties.id))}if(1<b.length){var f=document.getElementById("normadModal");l=!1;if("undefined"==typeof f||null==
f){l=!0;c=document.createElement("div");c.className="modal";c.setAttribute("tabindex",-1);c.setAttribute("role","dialog");c.setAttribute("id","normadModal");d=document.createElement("div");d.className="modal-dialog";d.setAttribute("role","document");e=document.createElement("div");e.className="modal-header";var g=document.createElement("h5");g.className="modal-title";var a=document.createElement("button");a.className="close";a.setAttribute("type","button");a.setAttribute("data-dismiss","modal");a.setAttribute("aria-label",
"Fermer");var k=document.createElement("span");k.setAttribute("aria-hidden","true");k.innerHTML="&times;";a.appendChild(k);e.appendChild(g);e.appendChild(a);g=document.createElement("div");g.className="modal-body";a=document.createElement("div");a.className="modal-footer";k=document.createElement("button");k.className="btn btn-primary";k.setAttribute("type","button");k.innerHTML="Valider mon choix";let b=document.createElement("button");b.className="btn btn-secondary";b.setAttribute("type","button");
b.innerHTML="Annuler";b.setAttribute("data-dismiss","modal");a.appendChild(k);a.appendChild(b);d.appendChild(e);d.appendChild(g);d.appendChild(a);c.appendChild(d);f=c;d=g}else d=f.querySelector(".modal-body");for(;d.firstChild&&d.removeChild(d.firstChild););f.querySelector(".modal-title").innerHTML="Choisissez une adresse valide";for(c=0;c<b.length;c++)e=b[c].postcode+" - "+b[c].city,n||(e=b[c].address+", "+e),g=document.createElement("div"),g.className="input-group mb-1",p&&(document.createElement("div").className=
"input-group-prepend input-group-addon",document.createElement("div").className="input-group-text"),a=document.createElement("input"),a.setAttribute("type","radio"),a.setAttribute("id","normAddr-"+c),a.setAttribute("name","normadChoice"),a.dataset.id=c,p?(igt.appendChild(a),igp.appendChild(igt),g.appendChild(igp)):g.appendChild(a),a=document.createElement("label"),a.className="form-control",a.setAttribute("for","normAddr-"+c),a.innerHTML=e,g.appendChild(a),d.appendChild(g);p?f.modal("show"):(l&&document.body.appendChild(f),
f.style.display="block",f.querySelector(".btn-secondary").addEventListener("click",a=>{f.style.display="none"}),f.querySelector(".close").addEventListener("click",a=>{f.style.display="none"}));f.querySelector(".btn-primary").addEventListener("click",a=>{a=document.querySelectorAll('input[name="normadChoice"]:checked');1==a.length&&(n||(q.value=b[a[0].dataset.id].address),m.value=b[a[0].dataset.id].postcode,t.value=b[a[0].dataset.id].city);p?f.modal("hide"):f.style.display="none"})}else 1==b.length?
(n||(q.value=b[0].address),m.value=b[0].postcode,t.value=b[0].city):console.log("Normad: No Address Found")}else console.log("Normad: Request Failed")};h.onerror=function(){console.log("Normad: Query Failed")};if("withCredentials"in h)h.open("GET","https://api-adresse.data.gouv.fr/search/?"+r,!0);else if("undefined"!=typeof XDomainRequest)h.open("GET","https://api-adresse.data.gouv.fr/search/?"+r);else throw h=null,Error("CORS not supported");null!==h&&h.send()})}}else console.log("'normaFields' var. not defined.")});