/*
 normad v1.0.1
 Normalisation d'Adresse Ã  partir des Open Data Gouvernementales

 ISC License
 by X-ray Computing
*/
document.addEventListener("DOMContentLoaded",function(){if("undefined"!==typeof normaFields){var u=Array.isArray(normaFields)?normaFields:Array(normaFields);for(field of u){let r=document.getElementById(field.address),n=document.getElementById(field.postcode),t=document.getElementById(field.city),p=field.partial;n.addEventListener("change",m=>{m=p?"q="+n.value+"&type=municipality":"q="+encodeURIComponent(r.value)+"&postcode="+n.value;var k=new XMLHttpRequest;k.onload=function(){if(200<=k.status&&
300>k.status){var g=JSON.parse(k.response);if(!g.hasOwnProperty("features"))return console.log('Normad: Bad Response ("features" is missing)'),!1;for(var q=!1,e=document.querySelectorAll("script"),a=0;a<e.length;a++)if(0<e[a].src.indexOf("bootstrap")){q=!0;break}var b=[];e=[];for(a=0;a<g.features.length;a++){var d=g.features[a];0>e.indexOf(d.properties.id)&&(b.push({id:d.properties.id,address:d.properties.name,postcode:d.properties.postcode,city:d.properties.city}),e.push(d.properties.id))}if(1<b.length){var h=
document.getElementById("normadModal");if("undefined"==typeof h||null==h){a=document.createElement("div");a.className="modal";a.setAttribute("tabindex",-1);a.setAttribute("role","dialog");a.setAttribute("id","normadModal");g=document.createElement("div");g.className="modal-dialog";g.setAttribute("role","document");e=document.createElement("div");e.className="modal-content";d=document.createElement("div");d.className="modal-header";var c=document.createElement("h5");c.className="modal-title";var f=
document.createElement("button");f.className="close";f.setAttribute("type","button");f.setAttribute("data-dismiss","modal");f.setAttribute("aria-label","Fermer");var l=document.createElement("span");l.setAttribute("aria-hidden","true");l.innerHTML="&times;";f.appendChild(l);d.appendChild(c);d.appendChild(f);c=document.createElement("div");c.className="modal-body";f=document.createElement("div");f.className="modal-footer";l=document.createElement("button");l.className="btn btn-primary";l.setAttribute("type",
"button");l.innerHTML="Valider mon choix";let b=document.createElement("button");b.className="btn btn-secondary";b.setAttribute("type","button");b.innerHTML="Annuler";b.setAttribute("data-dismiss","modal");f.appendChild(l);f.appendChild(b);e.appendChild(d);e.appendChild(c);e.appendChild(f);g.appendChild(e);a.appendChild(g);document.body.appendChild(a);h=document.getElementById("normadModal");g=c}else g=h.querySelector(".modal-body");for(;g.firstChild&&g.removeChild(g.firstChild););h.querySelector(".modal-title").innerHTML=
"Choisissez une adresse valide";for(a=0;a<b.length;a++)e=b[a].postcode+" - "+b[a].city,p||(e=b[a].address+", "+e),d=document.createElement("div"),d.className="input-group mb-1",c=document.createElement("input"),c.className="form-check-input mt-0",c.setAttribute("type","radio"),c.setAttribute("id","normAddr-"+a),c.setAttribute("name","normadChoice"),c.dataset.id=a,q?(f=document.createElement("div"),f.className="input-group-text",f.appendChild(c),d.appendChild(f)):d.appendChild(c),c=document.createElement("label"),
c.className="form-control",c.setAttribute("for","normAddr-"+a),c.innerHTML=e,d.appendChild(c),g.appendChild(d);if(q){var m=new bootstrap.Modal(h);m.show()}else h.style.display="block",h.querySelector(".btn-secondary").addEventListener("click",a=>{h.style.display="none"}),h.querySelector(".close").addEventListener("click",a=>{h.style.display="none"});h.querySelector(".btn-primary").addEventListener("click",a=>{a=document.querySelectorAll('input[name="normadChoice"]:checked');1==a.length&&(p||(r.value=
b[a[0].dataset.id].address),n.value=b[a[0].dataset.id].postcode,t.value=b[a[0].dataset.id].city);q?m.hide():h.style.display="none"})}else 1==b.length?(p||(r.value=b[0].address),n.value=b[0].postcode,t.value=b[0].city):console.log("Normad: No Address Found")}else console.log("Normad: Request Failed")};k.onerror=function(){console.log("Normad: Query Failed")};if("withCredentials"in k)k.open("GET","https://api-adresse.data.gouv.fr/search/?"+m,!0);else if("undefined"!=typeof XDomainRequest)k.open("GET",
"https://api-adresse.data.gouv.fr/search/?"+m);else throw k=null,Error("CORS not supported");null!==k&&k.send()})}}else console.log("'normaFields' var. not defined.")});